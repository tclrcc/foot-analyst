<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyse de Match - Pro Version</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link href="css/style.css" rel="stylesheet">
    <style>
        /* Surcharges sp√©cifiques pour la page D√©tails (le reste est dans style.css) */
        .confidence-meter { height: 8px; border-radius: 4px; background: #334155; overflow: hidden; }
        .confidence-fill { height: 100%; transition: width 1s ease-in-out; }
        .z-index-1 { z-index: 1; }
        .letter-spacing-1 { letter-spacing: 1px; }

        /* Box pour les stats projet√©es */
        .stat-box {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1rem;
        }

        /* Style sp√©cifique pour les conteneurs de logos dans le scoreboard */
        .scoreboard-logo-container {
            width: 80px;
            height: 80px;
            background-color: rgba(255, 255, 255, 0.05); /* Fond l√©g√®rement clair */
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem auto; /* Centrage et marge en bas */
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .scoreboard-logo {
            width: 100%;
            height: 100%;
            object-fit: contain;
            padding: 10px;
        }
    </style>
</head>
<body>
<div class="container py-4">
    <a href="/" class="btn btn-outline-secondary mb-4 border-secondary text-muted">
        <i class="bi bi-arrow-left"></i> Retour au Dashboard
    </a>

    <div class="card shadow-lg border-0 mb-4 position-relative overflow-hidden" style="background: linear-gradient(135deg, #1e293b, #090e17);">
        <div class="position-absolute top-50 start-50 translate-middle" style="width: 300px; height: 300px; background: radial-gradient(circle, rgba(59,130,246,0.1) 0%, rgba(0,0,0,0) 70%); border-radius: 50%;"></div>

        <div class="card-body text-center py-5 position-relative z-index-1">
            <span class="badge bg-dark border border-secondary text-uppercase letter-spacing-1 mb-4 px-3 py-2 text-white shadow-sm" id="matchLeague">...</span>

            <div class="row align-items-center justify-content-center">
                <div class="col-4 text-center">
                    <div class="scoreboard-logo-container">
                        <img id="homeTeamLogo" src="/logos/default.png" alt="Logo Domicile" class="scoreboard-logo" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                        <span id="homeTeamInitial" class="fw-bold display-6 text-white" style="display:none;">?</span>
                    </div>
                    <h2 class="display-6 fw-bold text-white mb-2 text-truncate" id="homeTeamName" title="Equipe Domicile">...</h2>
                    <span class="badge bg-primary text-white border border-primary px-3 py-2 shadow-sm" id="homeFormBadge">...</span>
                </div>

                <div class="col-2 text-center px-0">
                    <div class="text-muted small fw-bold text-uppercase mb-1" style="letter-spacing: 0.1em; font-size: 0.7rem;">Coup d'envoi</div>
                    <div class="h5 fw-bold text-white mb-3" id="matchDate">--:--</div>
                    <div class="badge bg-dark text-muted border border-secondary rounded-pill px-3 py-1 shadow-sm">VS</div>
                </div>

                <div class="col-4 text-center">
                    <div class="scoreboard-logo-container">
                        <img id="awayTeamLogo" src="/logos/default.png" alt="Logo Ext√©rieur" class="scoreboard-logo" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                        <span id="awayTeamInitial" class="fw-bold display-6 text-white" style="display:none;">?</span>
                    </div>
                    <h2 class="display-6 fw-bold text-white mb-2 text-truncate" id="awayTeamName" title="Equipe Ext√©rieure">...</h2>
                    <span class="badge bg-danger text-white border border-danger px-3 py-2 shadow-sm" id="awayFormBadge">...</span>
                </div>
            </div>

            <button id="btnRecalculate" class="btn btn-outline-light rounded-pill mt-5 px-4 shadow-sm transition-all">
                <i class="bi bi-arrow-clockwise me-2"></i>Recalculer via IA
            </button>
        </div>
    </div>

    <div class="card border-0 mb-4">
        <div class="card-header border-bottom-0 pb-2 pt-4 px-4 bg-transparent d-flex justify-content-between align-items-center">
            <span class="fw-bold fs-5 text-white"><i class="bi bi-bar-chart-line-fill text-primary me-2"></i>Rapport de Force (Moyennes)</span>
        </div>
        <div class="card-body px-4">

            <div class="d-flex justify-content-between mb-4 border-bottom border-secondary border-opacity-25 pb-4">
                <div class="text-center w-25">
                    <span class="d-block small text-muted text-uppercase fw-bold mb-1">Rang</span>
                    <span class="fs-4 fw-bold text-primary" id="uiHomeRank">#--</span>
                </div>
                <div class="text-center align-self-center w-50">
                    <a href="#" id="btnStandings" class="badge bg-dark border border-secondary px-3 py-2 text-decoration-none text-white shadow-sm transition-all" style="font-size: 0.8rem;">
                        <i class="bi bi-list-ol text-primary me-2"></i>Voir le Classement
                    </a>
                </div>
                <div class="text-center w-25">
                    <span class="d-block small text-muted text-uppercase fw-bold mb-1">Rang</span>
                    <span class="fs-4 fw-bold text-danger" id="uiAwayRank">#--</span>
                </div>
            </div>

            <h6 class="text-muted text-uppercase small fw-bold mb-4 mt-2">üìä Volume de jeu</h6>
            <div id="comp-possession"></div>
            <div id="comp-shots"></div>
            <div id="comp-sot"></div>
            <div id="comp-corners"></div>

            <h6 class="text-muted text-uppercase small fw-bold mb-4 mt-5">üß† Analyse Tactique Avanc√©e</h6>

            <div class="row text-center mb-4">
                <div class="col-6 border-end border-secondary border-opacity-25">
                    <div class="small text-muted mb-2 text-uppercase fw-bold">xG Moyen (Cr√©ation)</div>
                    <div class="d-flex justify-content-around">
                        <span class="fs-4 fw-bold text-primary" id="uiHomeXg">--</span>
                        <span class="fs-4 fw-bold text-danger" id="uiAwayXg">--</span>
                    </div>
                </div>
                <div class="col-6">
                    <div class="small text-muted mb-2 text-uppercase fw-bold">xGA (D√©fense subie)</div>
                    <div class="d-flex justify-content-around">
                        <span class="fs-4 fw-bold text-primary" id="uiHomeXga">--</span>
                        <span class="fs-4 fw-bold text-danger" id="uiAwayXga">--</span>
                    </div>
                </div>
            </div>

            <div id="comp-ppda" class="mt-4" title="Passes Allowed Per Defensive Action"></div>
            <div class="text-center small text-muted fst-italic mt-2" style="font-size: 0.75rem;">
                <i class="bi bi-info-circle me-1"></i> PPDA : Un score bas indique un pressing agressif (Ex: Liverpool ~9.0)
            </div>

        </div>
    </div>

    <div class="row g-4">
        <div class="col-lg-8">
            <div class="card border-0 mb-4 h-100">
                <div class="card-header bg-transparent border-bottom-0 pt-4 px-4">
                    <h5 class="fw-bold text-white"><i class="bi bi-pie-chart-fill text-primary me-2"></i>Verdict de l'Algorithme</h5>
                </div>
                <div class="card-body px-4 pb-4 d-flex flex-column">

                    <div class="mb-5">
                        <div class="d-flex justify-content-between mb-2 fw-bold" style="font-size: 0.9rem;">
                            <span class="text-primary">1 - Domicile (<span id="prob1">--</span>%)</span>
                            <span class="text-muted">N - Nul (<span id="probN">--</span>%)</span>
                            <span class="text-danger">2 - Ext√©rieur (<span id="prob2">--</span>%)</span>
                        </div>
                        <div class="progress" style="height: 18px; background-color: #334155; border-radius: 9px;">
                            <div id="bar1" class="progress-bar bg-primary" role="progressbar" style="width: 0%"></div>
                            <div id="barN" class="progress-bar bg-secondary" role="progressbar" style="width: 0%"></div>
                            <div id="bar2" class="progress-bar bg-danger" role="progressbar" style="width: 0%"></div>
                        </div>
                    </div>

                    <div class="row text-center g-3 mb-5">
                        <div class="col-md-4">
                            <div class="stat-box">
                                <small class="text-muted d-block text-uppercase fw-bold mb-1">Score le + probable</small>
                                <span class="h3 fw-bold text-white mb-0" id="exactScore">--</span>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="stat-box">
                                <small class="text-muted d-block text-uppercase fw-bold mb-1">Expected Goals</small>
                                <span class="h3 fw-bold text-info mb-0" id="xgProjected">-- - --</span>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="stat-box">
                                <small class="text-muted d-block text-uppercase fw-bold mb-1">Indice Confiance</small>
                                <span class="h3 fw-bold text-success mb-0" id="confidenceScore">--%</span>
                                <div class="confidence-meter mt-2"><div id="confidenceBar" class="confidence-fill bg-success" style="width: 0%"></div></div>
                            </div>
                        </div>
                    </div>

                    <h6 class="fw-bold text-muted text-uppercase mb-3"><i class="bi bi-lightbulb-fill text-warning me-2"></i>Insights IA (Tendances)</h6>
                    <div class="row g-2 mb-4 flex-grow-1" id="insightsContainer">
                    </div>

                    <div class="mt-auto">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <small class="fw-bold text-muted"><i class="bi bi-robot me-2"></i>Contre-expertise (Prompt IA)</small>
                            <button class="btn btn-sm btn-outline-secondary rounded-pill py-0 px-3" onclick="copyPrompt()">
                                <i class="bi bi-clipboard me-1"></i> Copier
                            </button>
                        </div>
                        <textarea id="aiPromptText" class="form-control bg-dark text-success border-secondary font-monospace" rows="3" style="font-size: 0.8rem; resize: none;" readonly></textarea>
                    </div>

                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card border-0 mb-4 h-100">
                <div class="card-header bg-transparent fw-bold border-bottom border-secondary border-opacity-25 pb-3 pt-4 px-4 text-white">
                    <i class="bi bi-bullseye text-primary me-2"></i>March√©s des Buts
                </div>
                <div class="card-body px-4 pt-4">

                    <div class="alert value-bet-card text-center mb-4" id="valueBetCard" style="display: none;">
                        <h6 class="fw-bold text-warning mb-1"><i class="bi bi-star-fill me-1"></i>Value Bet D√©tect√©</h6>
                        <small class="text-white">Avantage algorithmique sur :</small><br>
                        <strong class="fs-5 text-white" id="valueBetTeam">--</strong>
                    </div>

                    <div class="mb-4">
                        <div class="d-flex justify-content-between small fw-bold mb-2">
                            <span class="text-success">BTTS : Oui (<span id="uiBtts">--</span>%)</span>
                            <span class="text-danger">Non (<span id="uiBttsNo">--</span>%)</span>
                        </div>
                        <div class="progress shadow-sm" style="height: 12px; border-radius: 6px; background-color: #334155;">
                            <div id="barBtts" class="progress-bar bg-success" style="width: 0%"></div>
                            <div id="barBttsNo" class="progress-bar bg-danger" style="width: 0%"></div>
                        </div>
                    </div>

                    <div class="mb-4">
                        <div class="d-flex justify-content-between small fw-bold mb-2">
                            <span class="text-primary">+1.5 Buts (<span id="uiOver15">--</span>%)</span>
                            <span class="text-muted">-1.5 Buts (<span id="uiUnder15">--</span>%)</span>
                        </div>
                        <div class="progress shadow-sm" style="height: 12px; border-radius: 6px; background-color: #334155;">
                            <div id="barOver15" class="progress-bar bg-primary" style="width: 0%"></div>
                            <div id="barUnder15" class="progress-bar bg-secondary" style="width: 0%"></div>
                        </div>
                    </div>

                    <div class="mb-4">
                        <div class="d-flex justify-content-between small fw-bold mb-2">
                            <span class="text-primary">+2.5 Buts (<span id="uiOver25">--</span>%)</span>
                            <span class="text-muted">-2.5 Buts (<span id="uiUnder25">--</span>%)</span>
                        </div>
                        <div class="progress shadow-sm" style="height: 12px; border-radius: 6px; background-color: #334155;">
                            <div id="barOver25" class="progress-bar bg-primary" style="width: 0%"></div>
                            <div id="barUnder25" class="progress-bar bg-secondary" style="width: 0%"></div>
                        </div>
                    </div>

                    <div class="mb-4 pt-2 border-top border-secondary border-opacity-25">
                        <div class="d-flex justify-content-between small fw-bold mb-2">
                            <span class="text-warning">+3.5 Buts (<span id="uiOver35">--</span>%)</span>
                        </div>
                        <div class="progress shadow-sm" style="height: 6px; border-radius: 3px; background-color: #334155;">
                            <div id="barOver35" class="progress-bar bg-warning" style="width: 0%"></div>
                        </div>
                    </div>

                    <div class="mt-4 p-3 bg-dark rounded border border-secondary border-opacity-25 text-center">
                        <div class="small text-muted text-uppercase fw-bold mb-1">Indice de Volatilit√© (Chaos)</div>
                        <div id="uiVolatility" class="fs-5 fw-bold">--</div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const urlParams = new URLSearchParams(window.location.search);
    const matchId = urlParams.get('id');

    async function loadAnalysis() {
        try {
            const res = await fetch(`/api/v1/analyses/${matchId}`);
            if (!res.ok) throw new Error("Erreur chargement");
            const match = await res.json();
            const pred = match.prediction;

            // --- INT√âGRATION DES LOGOS ---
            const homeLogo = document.getElementById('homeTeamLogo');
            const awayLogo = document.getElementById('awayTeamLogo');
            const homeInit = document.getElementById('homeTeamInitial');
            const awayInit = document.getElementById('awayTeamInitial');

            const leagueId = match.homeTeam.league?.id;
            const btnStandings = document.getElementById('btnStandings');
            if(leagueId) {
                btnStandings.href = `/standings.html?leagueId=${leagueId}&matchId=${matchId}`;
                btnStandings.onmouseover = () => { btnStandings.className = "badge bg-primary border border-primary px-3 py-2 text-decoration-none text-white shadow-lg transition-all"; };
                btnStandings.onmouseout = () => { btnStandings.className = "badge bg-dark border border-secondary px-3 py-2 text-decoration-none text-white shadow-sm transition-all"; };
            } else {
                btnStandings.style.display = 'none'; // S√©curit√© si la ligue est introuvable
            }

            // R√©initialisation de l'affichage (au cas o√π on recharge la page)
            homeLogo.style.display = 'block';
            homeInit.style.display = 'none';
            awayLogo.style.display = 'block';
            awayInit.style.display = 'none';

            // Application des URLs (ou d'une image par d√©faut transparente si non d√©finie)
            homeLogo.src = match.homeTeam?.logoUrl || 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';
            awayLogo.src = match.awayTeam?.logoUrl || 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';

            // Application des initiales pour le fallback
            homeInit.innerText = match.homeTeam?.name?.charAt(0) || '?';
            awayInit.innerText = match.awayTeam?.name?.charAt(0) || '?';

            // Header info (Textes)
            document.getElementById('matchLeague').innerText = match.homeTeam.league?.name || "Championnat inconnu";

            // Mise √† jour des noms avec attribut title pour le survol
            const homeNameEl = document.getElementById('homeTeamName');
            homeNameEl.innerText = match.homeTeam.name;
            homeNameEl.title = match.homeTeam.name;

            const awayNameEl = document.getElementById('awayTeamName');
            awayNameEl.innerText = match.awayTeam.name;
            awayNameEl.title = match.awayTeam.name;

            // Formatage propre de la date pour le header (Ex: "12 Oct - 20:45")
            const d = new Date(match.matchDate);
            const dateOpts = { day: 'numeric', month: 'short' };
            const timeOpts = { hour: '2-digit', minute: '2-digit' };
            document.getElementById('matchDate').innerText = `${d.toLocaleDateString('fr-FR', dateOpts)} - ${d.toLocaleTimeString('fr-FR', timeOpts)}`;

            // Badges Forme (Utilise Power Score si dispo)
            if(pred) {
                document.getElementById('homeFormBadge').innerText = `Puissance: ${pred.homePowerScore}`;
                document.getElementById('awayFormBadge').innerText = `Puissance: ${pred.awayPowerScore}`;
            }

            // Mapping des classements
            document.getElementById('uiHomeRank').innerText = match.homeStats?.rank ? '#' + match.homeStats.rank : 'N/A';
            document.getElementById('uiAwayRank').innerText = match.awayStats?.rank ? '#' + match.awayStats.rank : 'N/A';

            // 2. G√©n√©ration des barres de comparaison miroir
            renderComparisonBar('comp-possession', 'Possession', match.homeStats?.avgPossession, match.awayStats?.avgPossession, true);
            renderComparisonBar('comp-shots', 'Tirs / match', match.homeStats?.avgShots, match.awayStats?.avgShots);
            renderComparisonBar('comp-sot', 'Tirs Cadr√©s / match', match.homeStats?.avgShotsOnTarget, match.awayStats?.avgShotsOnTarget);
            renderComparisonBar('comp-corners', 'Corners / match', match.homeStats?.avgCorners, match.awayStats?.avgCorners);

            // 3. Stats Avanc√©es
            document.getElementById('uiHomeXg').innerText = match.homeStats?.xG || '--';
            document.getElementById('uiAwayXg').innerText = match.awayStats?.xG || '--';
            document.getElementById('uiHomeXga').innerText = match.homeStats?.xGA || '--';
            document.getElementById('uiAwayXga').innerText = match.awayStats?.xGA || '--';

            // PPDA : Inverse logic = true (le plus petit est le meilleur)
            renderComparisonBar('comp-ppda', 'Pressing (PPDA)', match.homeStats?.ppda, match.awayStats?.ppda, false, true);

            if (pred) {
                // Probabilit√©s Bars
                const p1 = pred.homeWinProbability;
                const pN = pred.drawProbability;
                const p2 = pred.awayWinProbability;

                document.getElementById('prob1').innerText = p1;
                document.getElementById('probN').innerText = pN;
                document.getElementById('prob2').innerText = p2;

                document.getElementById('bar1').style.width = `${p1}%`;
                document.getElementById('barN').style.width = `${pN}%`;
                document.getElementById('bar2').style.width = `${p2}%`;

                // Stats Principales
                document.getElementById('exactScore').innerText = pred.exactScore;
                document.getElementById('xgProjected').innerText = `${pred.predictedHomeGoals} - ${pred.predictedAwayGoals}`;

                // Confiance & Volatilit√©
                const conf = pred.confidenceScore || 70;
                document.getElementById('confidenceScore').innerText = conf + '%';
                document.getElementById('confidenceBar').style.width = conf + '%';

                const confBar = document.getElementById('confidenceBar');
                if(conf < 50) confBar.className = 'confidence-fill bg-danger';
                else if(conf < 75) confBar.className = 'confidence-fill bg-warning';
                else confBar.className = 'confidence-fill bg-success';

                // Volatilit√©
                const volBadge = document.getElementById('uiVolatility');
                let vol = pred.matchVolatility || 1.0;
                if(vol > 1.2) {
                    volBadge.innerHTML = `<span class="text-danger">${vol} (√âlev√©e üî•)</span>`;
                } else if (vol < 0.8) {
                    volBadge.innerHTML = `<span class="text-secondary">${vol} (Ferm√© üõ°Ô∏è)</span>`;
                } else {
                    volBadge.innerHTML = `<span class="text-muted">${vol} (Standard)</span>`;
                }

                // Insights
                if (pred.keyFacts && pred.keyFacts.length > 0) {
                    const container = document.getElementById('insightsContainer');
                    container.innerHTML = pred.keyFacts.map(fact => {
                        let bgClass = "bg-primary border-primary text-primary";
                        if(fact.includes("üî•")) bgClass = "bg-danger border-danger text-danger";
                        if(fact.includes("‚ö†Ô∏è")) bgClass = "bg-warning border-warning text-warning";
                        if(fact.includes("üõ°Ô∏è") || fact.includes("üéØ")) bgClass = "bg-success border-success text-success";

                        return `<div class="col-12">
                   <div class="p-3 rounded bg-opacity-10 border border-opacity-25 shadow-sm ${bgClass}" style="font-size:0.85rem;">
                       ${fact}
                   </div>
                </div>`;
                    }).join('');
                } else {
                    document.getElementById('insightsContainer').innerHTML =
                        `<div class="col-12 text-muted fst-italic">Aucune tendance majeure d√©tect√©e par l'algorithme.</div>`;
                }

                // AI Prompt
                if (pred.aiAnalysisPrompt) {
                    document.getElementById('aiPromptText').value = pred.aiAnalysisPrompt;
                }

                // March√©s Alternatifs
                document.getElementById('uiBtts').innerText = pred.bttsProb + '%';
                document.getElementById('barBtts').style.width = pred.bttsProb + '%';
                document.getElementById('uiBttsNo').innerText = pred.probBTTS_No;

                document.getElementById('uiOver15').innerText = pred.probOver1_5 + '%';
                document.getElementById('barOver15').style.width = pred.probOver1_5 + '%';

                document.getElementById('uiOver25').innerText = pred.over2_5_Prob + '%';
                document.getElementById('barOver25').style.width = pred.over2_5_Prob + '%';

                document.getElementById('uiOver35').innerText = pred.probOver3_5 + '%';
                document.getElementById('barOver35').style.width = pred.probOver3_5 + '%';

                // Value Bet Display
                if (pred.valueBetDetected) {
                    document.getElementById('valueBetCard').style.display = 'block';
                    let teamName = "";
                    if (pred.valueBetDetected === "HOME") teamName = match.homeTeam.name;
                    else if (pred.valueBetDetected === "AWAY") teamName = match.awayTeam.name;
                    else teamName = "Match Nul";
                    document.getElementById('valueBetTeam').innerText = teamName;
                }
            }
        } catch (e) {
            console.error(e);
            alert("Impossible de charger l'analyse.");
        }
    }

    // NOUVELLE FONCTION : Rendu des barres de comparaison en "Miroir"
    function renderComparisonBar(elementId, label, homeVal, awayVal, isPercentage = false, inverseLogic = false) {
        const hVal = parseFloat(homeVal) || 0;
        const aVal = parseFloat(awayVal) || 0;
        const total = hVal + aVal;

        let hPct = 50, aPct = 50;
        if(total > 0) {
            hPct = (hVal / total) * 100;
            aPct = (aVal / total) * 100;
        }

        let hDisplay = isPercentage ? hVal + '%' : hVal;
        let aDisplay = isPercentage ? aVal + '%' : aVal;

        // Logique de surbrillance
        let homeBold = hVal >= aVal ? 'text-primary fw-bold' : 'text-muted';
        let awayBold = aVal >= hVal ? 'text-danger fw-bold' : 'text-muted';

        if (inverseLogic) {
            homeBold = hVal <= aVal ? 'text-primary fw-bold' : 'text-muted';
            awayBold = aVal <= hVal ? 'text-danger fw-bold' : 'text-muted';
        }

        document.getElementById(elementId).innerHTML = `
        <div class="mb-4">
            <div class="d-flex justify-content-between align-items-end mb-1">
                <span class="fs-5 ${homeBold}">${hDisplay}</span>
                <span class="text-muted text-uppercase fw-bold" style="font-size:0.7rem; letter-spacing: 0.05em;">${label}</span>
                <span class="fs-5 ${awayBold}">${aDisplay}</span>
            </div>
            <div class="d-flex justify-content-center align-items-center gap-1">
                <div class="w-50 d-flex justify-content-end rounded-start" style="height: 6px; background-color: #334155;">
                    <div class="bg-primary rounded-start" style="width: ${hPct}%; transition: width 1s ease-out;"></div>
                </div>
                <div style="width: 2px; height: 12px; background-color: #64748b;"></div>
                <div class="w-50 d-flex justify-content-start rounded-end" style="height: 6px; background-color: #334155;">
                    <div class="bg-danger rounded-end" style="width: ${aPct}%; transition: width 1s ease-out;"></div>
                </div>
            </div>
        </div>
        `;
    }

    // Gestion du Recalcul manuel
    document.getElementById('btnRecalculate').addEventListener('click', async function() {
        const btn = this;
        btn.disabled = true;
        btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span> Recalcul IA en cours...';

        try {
            const res = await fetch(`/api/v1/analyses/${matchId}/recalculate`, { method: 'POST' });
            if (res.ok) {
                window.location.reload();
            } else {
                alert("Erreur lors du recalcul.");
            }
        } catch(e) { console.error(e); }
        btn.disabled = false;
        btn.innerHTML = '<i class="bi bi-arrow-clockwise me-2"></i>Recalculer via IA';
    });

    // Copie du Prompt IA
    function copyPrompt() {
        const copyText = document.getElementById("aiPromptText");
        copyText.select();
        copyText.setSelectionRange(0, 99999);
        navigator.clipboard.writeText(copyText.value);
        alert("‚úÖ Prompt copi√© ! Colle-le dans ChatGPT, Claude ou Gemini.");
    }

    // Initialisation
    loadAnalysis();
</script>

</body>
</html>
